# Cast AI 要件定義書（PWA版）

## 1. プロジェクト概要

### 1.1 目的
夜職キャストの顧客管理と売上向上を支援する、シンプルなAI機能搭載PWA（Progressive Web App）の開発

### 1.2 ターゲットユーザー
- 夜職で働くキャスト
- 20〜35歳
- スマートフォンユーザー

### 1.3 解決する課題
1. 顧客情報の管理が大変
2. 誰に連絡すべきか分からない
3. 売上を伸ばしたい

### 1.4 PWAを選択する理由
- **即時公開**: App Store/Google Playの審査不要
- **低コスト**: 初期は無料ホスティングで運用可能
- **迅速な更新**: ユーザーフィードバックを即座に反映
- **クロスプラットフォーム**: iOS/Android両対応、一つのコードベース
- **アプリライクな体験**: ホーム画面追加、オフライン動作、プッシュ通知

## 2. 機能要件

### 2.1 顧客管理機能

#### 2.1.1 顧客カード
- **基本情報**
  - 名前（ニックネーム）
  - 誕生日
  - 電話番号/LINE ID
  - メモ（自由記述）
- **来店記録**
  - 来店日
  - 売上金額
  - 簡単メモ

#### 2.1.2 シンプルAI分析
- **自動VIPランク判定**（3段階）
  - ゴールド：高額・高頻度
  - シルバー：中額・中頻度
  - ブロンズ：その他
- **AIが判定基準を自動学習**（売上×来店頻度）

### 2.2 売上ダッシュボード

#### 2.2.1 基本集計
- 今月の売上
- 今日の売上
- 顧客別売上TOP5

#### 2.2.2 AI売上予測
- **今月の着地予想**（過去3ヶ月の傾向から計算）
- シンプルな棒グラフ表示
- **注釈表示**：「※過去のデータに基づく参考値です」

### 2.3 AIアシスタント機能（核心機能）

#### 2.3.1 今日の営業提案
- **毎日3名をAIが自動ピックアップ**
  - 2名：優先度スコアが高い顧客
  - 1名：サプライズ枠（以下から選出）
    - 最近ランクダウンした顧客
    - 新規顧客（登録1ヶ月以内）
    - しばらく連絡していない顧客

- **提案理由を具体的な数字で表示**：
  - 「誕生日まであと5日です」
  - 「平均来店間隔まであと3日」
  - 「最終来店から45日経過（通常は30日間隔）」
  - 「先月より来店頻度が下がっています」
  - 「新規のお客様です（関係構築のチャンス）」

#### 2.3.2 スマート通知
- **Webプッシュ通知による来店パターンに基づく通知**
  - 例：「〇〇様は通常2週間おきに来店。連絡時期です」
- 誕生日3日前通知
- 通知から直接LINE/電話を起動可能

## 3. 非機能要件

### 3.1 パフォーマンス
- 初回読み込み：5秒以内
- 2回目以降：2秒以内（Service Workerキャッシュ）
- AI分析：3秒以内
- 顧客上限：500名

### 3.2 セキュリティ
- HTTPS必須
- ローカルストレージの暗号化
- パスコード/生体認証（Web Authentication API）
- **自動バックアップ（全プラン標準機能）**

### 3.3 使いやすさ
- レスポンシブデザイン（モバイルファースト）
- 片手操作最適化
- タッチターゲット44px以上
- インストール促進UI

### 3.4 プライバシー保護
- 利用規約・プライバシーポリシーの整備
- 顧客データの完全削除機能
- データエクスポート機能（JSON/CSV）
- 顧客の個人情報は本人同意なく第三者提供しない旨明記

### 3.5 PWA要件
- **マニフェストファイル**: アプリ名、アイコン、テーマカラー定義
- **Service Worker**: オフライン対応、バックグラウンド同期
- **HTTPS**: セキュアな通信
- **レスポンシブ**: 全画面サイズ対応

### 3.6 iOS Safari対応
- **制限事項**:
  - プッシュ通知: iOS 16.4以降でのみ対応
  - インストール方法: 「共有」→「ホーム画面に追加」の案内UI必須
  - 120MB以上のオフラインストレージ使用時に警告
- **対策**:
  - インストール手順の視覚的ガイド
  - iOS判定してカスタムインストールバナー表示
  - プッシュ通知の代替として、アプリ起動時の通知表示

## 4. 技術スタック

### 4.1 フロントエンド
- **フレームワーク**: React + TypeScript
- **状態管理**: Zustand（軽量でPWAに最適）
- **UI/スタイリング**: Tailwind CSS + shadcn/ui
- **PWA対応**: Workbox（Service Worker管理）
- **データベース**: IndexedDB（Dexie.js）
- **ビルドツール**: Vite

### 4.2 バックエンド（最小構成）
- **ホスティング**: Vercel or Netlify（初期は無料プラン）
- **認証**: Firebase Auth or Auth0
- **バックアップ**: Firebase Firestore or Supabase
- **プッシュ通知**: Firebase Cloud Messaging

### 4.3 開発環境
- **バージョン管理**: Git/GitHub
- **CI/CD**: GitHub Actions + Vercel/Netlify
- **型チェック**: TypeScript
- **リンター**: ESLint + Prettier

### 4.4 決済機能
- **決済プロバイダ**: Stripe（PWA対応、手数料3.6%）
- **実装方法**: Stripe Checkout（リダイレクト型）
- **対応決済**: クレジットカード、Apple Pay、Google Pay
- **セキュリティ**: PCI DSS準拠（Stripeが担保）

### 4.5 監視・分析
- **エラー監視**: Sentry（無料枠：月5,000エラーまで）
- **アナリティクス**: Google Analytics 4
- **パフォーマンス監視**: Web Vitals自動計測
- **ユーザー行動追跡**: 
  - インストール完了率
  - 機能利用率
  - エラー発生率
  - 有料プラン転換ファネル

## 5. AI機能の実装詳細

### 5.1 クライアントサイドAI
- **軽量な実装**: ブラウザ内で動作する簡易アルゴリズム
- **来店パターン認識**: 移動平均による間隔計算
- **優先度スコアリング**: 重み付け計算（調整可能）

### 5.2 シンプルな計算例
```javascript
// 優先度スコア計算
const calculatePriority = (customer) => {
  const daysSinceLastVisit = getDaysSince(customer.lastVisit);
  const avgInterval = customer.avgVisitInterval || 30;
  const birthdayBonus = getDaysUntilBirthday(customer.birthday) < 7 ? 0.3 : 0;
  
  return (
    (daysSinceLastVisit / avgInterval) * 0.5 +
    (customer.totalRevenue / 100000) * 0.3 +
    birthdayBonus * 0.2
  );
};
```

### 5.3 サプライズ枠の選出ロジック
```javascript
const selectSurpriseCustomer = (customers) => {
  const candidates = [
    ...getDowngradedCustomers(customers),
    ...getNewCustomers(customers),
    ...getDormantCustomers(customers)
  ];
  return selectRandom(candidates);
};
```

## 6. データ構造

### 6.1 IndexedDBスキーマ
```typescript
interface Customer {
  id: string;
  name: string;
  birthday?: string;
  phone?: string;
  lineId?: string;
  memo?: string;
  vipRank: 'gold' | 'silver' | 'bronze';
  totalRevenue: number;
  lastVisit: Date;
  createdAt: Date;
  avgVisitInterval?: number;
}

interface Visit {
  id: string;
  customerId: string;
  date: Date;
  revenue: number;
  memo?: string;
}

interface AIAnalysis {
  customerId: string;
  priorityScore: number;
  lastRank?: string;
  analyzedAt: Date;
}
```

## 7. 開発スケジュール

### Phase 1（3週間）：PWA基盤構築
- PWAセットアップ（マニフェスト、Service Worker）
- 基本UI実装（React + Tailwind）
- 顧客登録・一覧表示
- IndexedDBデータ管理
- インストール促進UI
- iOS Safari対応（カスタムインストールバナー）

### Phase 2（3週間）：コア機能実装
- 来店記録機能
- 売上ダッシュボード
- 基本的なAI分析（優先度計算）
- データバックアップ（Firebase連携）
- エラー監視・アナリティクス設定

### Phase 3（2週間）：AI機能強化
- 今日の営業提案（3名ピックアップ）
- サプライズ枠実装
- 来店パターン学習
- プッシュ通知基盤

### Phase 4（2週間）：ブラッシュアップ
- UI/UX改善
- パフォーマンス最適化
- 有料プラン機能（Stripe統合）
- プロダクション環境構築

## 8. 料金プラン

### 無料プラン

- 顧客登録：**30名まで**（PWAは容量制限があるため）
- 基本機能すべて
- **自動バックアップ（1日1回）**
- AI提案：1日1回更新

### 有料プラン（月額680円）
- 顧客登録：無制限
- AI提案：リアルタイム更新
- **高度なバックアップ機能**
  - リアルタイム同期
  - CSVエクスポート
  - 過去30日分の復元ポイント
- 詳細な分析レポート
- 優先サポート

## 9. 成功指標（KPI）

### 9.1 PWA特有の指標
- **インストール率**: 初回訪問者の30%以上
- **再訪問率**: 1週間以内に50%以上
- **エンゲージメント**: 週3回以上起動40%

### 9.2 ビジネス指標
- **継続率**: 3ヶ月後50%以上
- **有料転換率**: 15%以上
- **月次アクティブ率（MAU）**: 60%以上

### 9.3 技術指標
- **Lighthouse スコア**: 90点以上
- **Time to Interactive**: 3秒以内
- **Service Worker キャッシュヒット率**: 80%以上

## 10. マーケティング戦略

### 10.1 配布方法
- **専用URL**: cast-ai.app（例）
- **QRコード**: 名刺やチラシに印刷
- **SNS共有**: Twitter、Instagram
- **SEO対策**: 検索エンジン最適化

### 10.2 インストール促進
- 初回訪問時にインストール案内
- インストール特典（顧客枠+5名など）
- チュートリアル完了でボーナス

## 11. リスク管理

| リスク | 影響度 | 対策 |
|--------|--------|------|
| ブラウザ互換性 | 中 | 主要ブラウザでの徹底テスト |
| オフライン時のデータ同期 | 高 | 堅牢な同期ロジック実装、競合解決ロジック |
| iOS Safariの制限 | 中 | 専用インストールガイド、代替UI提供 |
| ストレージ容量制限 | 低 | データ圧縮、古いデータのアーカイブ |
| 決済システムの障害 | 高 | Stripeステータスページ監視、エラーハンドリング |
| 個人情報漏洩 | 極高 | データ暗号化、定期的なセキュリティ監査 |

## 12. 競合優位性

- **即座にアクセス可能**: URLだけで利用開始
- **ストア審査なし**: 機能追加・修正が即座に反映
- **低い参入障壁**: インストール不要
- **開発コスト削減**: 単一コードベースで全デバイス対応
- **最新Web技術**: 技術力のアピール

## 13. 将来の拡張性

### 13.1 ネイティブアプリ化
- PWAで実績を作った後、React NativeやCapacitorでネイティブ化
- 既存のReactコードを最大限活用

### 13.2 追加機能案
- 音声メモ（Web Audio API）
- カメラ連携（顧客写真）
- GPSベースの来店記録
- AIチャットボット

## 14. 初期リリース時の重要事項

### 14.1 リリース前チェックリスト
- [ ] iOS/Androidでのインストールテスト完了
- [ ] 決済フローの本番環境テスト
- [ ] プライバシーポリシー・利用規約の法的確認
- [ ] SSL証明書の有効期限確認
- [ ] バックアップ・リストア機能の動作確認
- [ ] エラー監視の通知設定

